

package com.example.currFair.api.service.impl;

import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.ws.rs.WebApplicationException;
import javax.ws.rs.core.Response;
import javax.ws.rs.core.Response.ResponseBuilder;

import com.example.currFair.api.model.TradeMessage;
import com.example.currFair.api.service.MessageService;
import com.example.currFair.api.util.ApiTransaction;
import com.google.inject.Inject;

/**
 * REST implementation of Message Service(I)
 * 
 */
public class MessageServiceImpl  extends AbstractServiceImpl implements MessageService
{
    @Inject
    private MessageManager surveyManager;

   
    public Response consumeMessages(List<TradeMessage> tradeMessages) throws WebApplicationException
    {

        ApiTransaction transaction = transactionProvider.get().init("submitSurvey", "loginId=%d;surveyId=%s", surveySubmissions.getLoginId() , surveySubmissions.getSurveyId());
        
        surveySubmissions.setIpAddress(req.getRemoteAddr());
        surveySubmissions.setBrowser(req.getHeader("User-Agent").substring(0,99));

        surveyManager.submitSurvey(surveySubmissions);
      
        ResponseBuilder builder = Response.noContent();
        return transaction.complete(builder.build());

    }
    
    public Response listSurveys(Long loginId) throws WebApplicationException
    {

        ApiTransaction transaction = transactionProvider.get().init("listSurveys", "loginId=%d;", loginId);

        List<SurveySubmissions> surveys = surveyManager.listSurveys(loginId);
      
        ResponseBuilder builder = Response.ok(surveys);
        return transaction.complete(builder.build());

    }
    
    
    
}
